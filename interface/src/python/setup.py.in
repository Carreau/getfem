#!/usr/bin/env python
# -*- coding: iso-8859-1 -*-
"""This is the getfem-python-interface module.

"""
from distutils.core import setup, Extension
import os

try:
    import numpy
except ImportError:
    raise Exception("PYTHON interface requires numpy")
npy_include_dir = numpy.get_include()

# cclibopts = "../../../src/.libs/libgetfem.a".split()
cclibopts = "".split() # getfem is explicitly added below
cclibopts += '@LIBS@'.split()

libnames = ['getfemint','getfem']
libnames += [l[2:] for l in cclibopts if l.startswith("-l")]
libdirs  = [l[2:] for l in cclibopts if l.startswith("-L")]
libdirs += [l for l in cclibopts if not l.startswith("-")]

libnames += ['stdc++','m']
libdirs = ['../.libs', '../../../src/.libs'] + libdirs
for i in range(0,len(libdirs)):
    if (os.path.isfile(libdirs[i])):
        libfile=os.path.splitext(os.path.basename(libdirs[i]))[0]
        #print libdirs[i], ' -> ', libfile
        if (libfile.startswith('lib')):
            libnames.append(libfile[3:])
            libdirs[i]=os.path.dirname(libdirs[i])
        else:
            libnames.append(libdirs[i])
            libdirs[i]= ''

libdirs = [l for l in libdirs if len(l.strip())]

#print "cclibopts=", cclibopts
#print "libnames = ", libnames
#print "libdirs = ", libdirs
getfemmod = Extension('_getfem',
                      include_dirs = ['@top_srcdir@/src/getfem','../../../src/getfem','@srcdir@/..','@srcdir@',npy_include_dir],
                      libraries = libnames, #['getfemint','getfem','stdc++','m'],
                      library_dirs = libdirs, #['../src/.libs',
#                                      '@GETFEM_STATICLIBS@'],
                      sources = ['getfem_python_c.c'])

setup (name = 'getfem-interface',
       license='LGPL',
       version = '4.0',
       maintainer="Yves Renard",
       maintainer_email="Yves.Renard@insa-lyon.fr",
       description = "This is the getfem-python-interface module",
       ext_modules = [getfemmod])
