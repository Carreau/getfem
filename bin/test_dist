#!/bin/sh

if test $# -lt 1; then
 echo usage : test_dist getfem++-1.4 machine compilo login
 echo machines : telline avec aCC
 echo          : calmip avec CC
 echo          : superdec avec cxx
 exit 0
fi


if test $# -lt 4; then 
  u=$(whoami)
else
  u=$4
fi

echo you are $u


scp $1.tar.gz $u@$2:
ssh $u@$2 "/bin/sh -c 'CXX=$3 && export CXX && mkdir -p temp_dist/$2/$3 && chmod -R u+rw temp_dist/$2/$3 && rm -rf temp_dist/$2/$3 && mkdir -p temp_dist/$2/$3 && cd temp_dist/$2/$3 && gunzip -c ../../../$1.tar.gz | tar xvf - && cd $1 && echo \$CXX && which \$CXX && ./configure && (which gmake; if test \$? -ne 0; then make distcheck; else gmake distcheck; fi) && cd .. && rm -fr $3 && touch $3.ok'"
