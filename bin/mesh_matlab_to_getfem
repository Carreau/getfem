#!/usr/bin/perl

#
# Transformation d'un maillage de la pde toolbox en maillage GETFEM
#
# 0) Faire le maillage avec PDETOOL et l'exporter dans les variables p,e et t
# 1) Sauvegarde du maillage avec les comandes :
#    fid = fopen('mesh_nodes', 'w');
#    fprintf(fid, "%f %f\n", p);
#    fclose(fid);
#    fid = fopen('mesh_triangles', 'w');
#    fprintf(fid, "%d %d %d %d\n", t);
#    fclose(fid);
# 2) utiliser ce shell
#    bin/mesh_matlab_to_getfem mesh_nodes mesh_triangles
#



open(F1, $ARGV[0]) or die "Open file impossible : $!\n";
open(F2, $ARGV[1]) or die "Open file impossible : $!\n";

print '% GETFEM MESH FILE', "\n\n";
print "BEGIN POINTS LIST \n\n";
$i = 0;
while ($ligne = <F1>)
{
  print "POINT $i ", $ligne;
  $i++;
}
print "\nEND POINTS LIST \n\n";


print "BEGIN CONVEX STRUCTURE DESCRIPTION\n\n";
print "CONVEX 0	= SIMPLEX 0\n";
print "CONVEX 1	= SIMPLEX 1\n";
print "CONVEX 3	= SIMPLEX 2\n";
print "\nEND CONVEX STRUCTURE DESCRIPTION\n\n";



print "BEGIN MESH STRUCTURE DESCRIPTION\n\n";
$i = 0;
while ($ligne = <F2>)
{
  ($j, $k, $l, $m) = split(' ', $ligne, 4);
  print "CONVEX $i 3 ", $j - 1,' ', $k - 1,' ', $l - 1, "\n";
  $i++;
}

print "END MESH STRUCTURE DESCRIPTION\n\n";

close(F1);
close(F2);
